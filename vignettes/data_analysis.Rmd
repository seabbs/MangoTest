---
title: "Exploring the NBA free throw data"
author: "Sam Abbott"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


**Aim** Visualise some aspect of the data you find interesting, e.g., the average number of free throws per period for the regular season and the playoffs.

Load analysis packages.

```{r packages}
library(tidyverse)
library(visdat)
library(MangoTest)
```

# Data 

Load in the data and explore structure. Data lists the play by play scores in multiple games accross several seasons.

```{r}
str(free_throws)
```

Split out teams, and scores in each game.

```{r split scores and teams}
tidy_free_throws <- free_throws %>% 
  separate(game, c("team_1", "team_2"), " - ") %>% 
  separate(score, c("score_1", "score_2"), " - ") %>% 
  separate(end_result, c("end_result_1", "end_result_2"), " - ")
```



Seperate game wide information, play information and scores information. Convert to factors as appropriate

```{r game-plays-info}
games_df <- tidy_free_throws %>% 
  select(game_id, team_1, team_2, playoffs,
         season, end_result_1, end_result_2) %>% 
  unique %>% 
  mutate(draw = ifelse(end_result_1 == end_result_2, "Yes", "No")) %>% 
  gather(key = "order", value = "team", team_1, team_2) %>% 
  separate(order, c("tmp", "order"), "_") %>% 
  select(-tmp) %>% 
  gather(key = "order2", value = "end_result", 
         end_result_1, end_result_2) %>% 
  separate(order2, c("tmp", "order2"), "result_") %>% 
  select(-tmp) %>% 
  filter(order == order2) %>% 
  select(-order2) %>% 
  mutate_at(.vars = vars(order, team, season, playoffs),
            .funs = funs(factor(.))) %>% 
  mutate(end_result = as.numeric(end_result))

plays_df <- tidy_free_throws %>% 
  select(game_id, period, play, shot_made, time) %>% 
  mutate(play = factor(play))

scores_df <- tidy_free_throws %>% 
  select(game_id, score_1, score_2, period, time) %>% 
    gather(key = "order", value = "score", score_1, score_2) %>% 
  separate(order, c("tmp", "order"), "_") %>% 
  select(-tmp) %>% 
  mutate(order = factor(order)) %>% 
  mutate(scores = as.numeric(score))
```

Add game outcome variable.

```{r game-outcome}
games_df <- games_df %>% 
  group_by(game_id) %>%
  arrange(desc(end_result), .by_group = TRUE) %>% 
  mutate(outcome = c("Won", "Lost")) %>% 
  ungroup() %>% 
  mutate(outcome = ifelse(draw %in% "Yes", "Draw", outcome)) %>% 
  mutate(outcome = factor(outcome)) %>% 
  select(-draw)
```

Summarise each dataset in turn

```{r sum-df}
summary(games_df)
summary(plays_df)
summary(scores_df)
```

